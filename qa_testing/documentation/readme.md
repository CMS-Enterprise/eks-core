# Quality Assurance (QA) Testing Framework

The _**qa_testing framework**_ is a collection of tools and scripts that can be used to test the quality of the codebase. The framework is designed with the end goal to be run in a CI/CD pipeline, but currently would be run locally against remote target clusters.

The _**qa_testing directory**_ is a self-contained directory that is designed to be run from any directory within the repo, but specifically with the intent to be run from the 'cluster' ( currently the 'example' ) directory. All bash scripts, python code, robot tests, and dependencies for these tools dynamically pull any remote GitHub or other community resources and build store them locally, self-contained within the _qa_testing_ directory.

The _**qa_testing framework**_ contains the following directories:

- **.3rd_party_tools** - contains external dependencies used by the qa_testing framework
- **configs** - contains qa_testing framework configuration files
- **documentation** - contains documentation files for the qa_testing framework
- **logs** - contains log files generated by the qa_testing framework
- **python** - contains qa_testing framework python code
- **robot** - contains qa_testing framework robot tests
- **scripts** - contains qa_testing framework bash scripts



## System Requirements
* **Awk** (version >= 5.1)
* **Aws-cli** (version >= 2.17)
* **Bash** (version >= 5.2)
* **Git** (version >= 2.45)
* **GNU** coreutils (version >= 8.32)
  * **Readlink**
  * **Sort**
  * **Tail**
  * **Uniq**
* **Grep** (version >= 3.7)
* **Jq** (version >= 1.7)
* **Kubectl** (version >= v1.30)
* **Kustomize** (version >= v5.0)
* **Pip** (version >= 23.3)
* **Python** (version >= 3.10)
* **Robot** Framework (version >= 6.1)
* **Xargs** (version >= 4.8)


## Get set up

1.) Clone and run locally the Energon-Kube repo

```git@github.com:CMS-Enterprise/Energon-Kube.git```

2.) Ensure that the terminal is running a _**bash**_ shell and then set up the current terminal to leverage the QA Testing Framework by sourcing the .qa_bashrc file.

```
bash
cd <repo-root>/qa_testing
source .qa_bashrc
```

### Running the tools

* Options in [ square ] brackets are optional
* Options in \< diaganal \> brackets are required

## QA Validation Bash Scripts

Once the .qa_bashrc file has been sourced, change directory to the target cluster main configuration directory where everything is expected to be run.

```
cd <repo-root>/<cluster-directory>  # This is the 'example' directory
```
The QA scripts are now in the current bash shell path and can be called directly.

#### List Validation Scripts:
* check_cluster_health.sh
* check_pods_triggering_errors.sh
* check_pods_withno_activities.sh
* fluentbit_check.sh
* observability_check_enhanced.sh
* test_cordens.sh
* test_kubeproxy.sh
* test_pod_identity_agent.sh

### Example: Check Cluster Health
Run from **_<repo-root>/<cluster-directory> $_**
```
check_cluster_health.sh
```

## QA Python Libraries

The QA Testing Framework self contains all the necessary python modules and by running the _**run_qa_python.sh**_ command the framework will generate a python virtual environment and pull down any necessary dependencies. Tab complete functinoality is also added so by calling _**run_qa_python.sh**_ and then using tab complete a list of available python scripts can be called.

The virtual environment will be created in the `<repor-root>/qa_testing/.venv_qa_testing` directory and all the dependencies will be defined in the `<repor-root>/qa_testing/python/requirements.txt`

### Example: Bringing up a cluster
Run from **_<repo-root>/<cluster-directory> $_**
```
run_qa_python bringup_cluster -t target_cluster
```

### Example: Destroying a cluster
Run from **_<repo-root>/<cluster-directory> $_**
```
run_qa_python bringdown_cluster -t target_cluster
```

## QA Robot Tests

The QA Testing Framework self contains all the necessary robot KubeLibrary Framework dependencies. By running the _**run_qa_robot.sh**_ and tab complete will list the available .robot test files in the `<repor-root>/qa_testing/robot/`

### Example: Execute KubeLibraryTest.robot 
Run from **_<repo-root>/<cluster-directory> $_**
```
run_qa_robot KubeLibraryTest.robot
```