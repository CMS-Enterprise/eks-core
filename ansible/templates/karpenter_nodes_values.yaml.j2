nodeClass:
  metadata:
    name: "main"
    annotations:
      description: "EC2NodeClass for running Amazon Linux 2 nodes with custom user data"

  spec:
    amiFamily: {{ karpenter_ami_family }}
    amiID: {{ karpenter_ami_id }}
    bottlerocket: {{ karpenter_bottlerocket }}
    role: {{ karpenter_iam_role }}
    subnetTag: {{ karpenter_subnet_tag }}
    securityGroupID:  {{ karpenter_security_group_id }}
    tags: {{ karpenter_tags }}

nodePool:
  metadata:
    name: "default"
    annotations:
      kubernetes.io/description: "General purpose NodePool for generic workloads"
  spec:
    template:
      spec:
        requirements:
          - key: "kubernetes.io/arch"
            operator: "In"
            values: ["amd64"]
          - key: "kubernetes.io/os"
            operator: "In"
            values: ["linux"]
          - key: "karpenter.sh/capacity-type"
            operator: "In"
            values: ["on-demand"]
          - key: "karpenter.k8s.aws/instance-category"
            operator: "In"
            values: ["c", "m", "r"]
          - key: "karpenter.k8s.aws/instance-generation"
            operator: "Gt"
            values: ["5"]
          - key: "usage"
            operator: "In"
            values: ["application", "system"]
        nodeClassRef:
          apiVersion: "karpenter.k8s.aws/v1beta1"
          kind: "EC2NodeClass"
          name: "default"